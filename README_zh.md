# mdai

通过文件与 ai 交流

大部分 ai 交互界面（web 或终端）无法编辑对话，错误的输入可能导致输出的偏离，若本来已经有大量对话，抛弃并新建一个对话的成本过高

而我们知道，ai 历史对话功能是在客户端记录并发送的

如何让对话像编辑文件一样自由？

那就编辑文件吧

## \_\_，启动！

```shell
mdai aichat.md
```

监听文件更改

> note
> 建议使用带有自动保存和自动重载的编辑器

输入用户前缀`:>`并输入内容

**换行，输入`?`并保存**

稍等片刻，ai 会返回回答

使用`---`可以新建一个对话，程序以存在`?`的对话进行请求，当然也可以新建个文件重新监听

## 配置

如果你只按上面的步骤，你会收到`TypeError`，因为你还没设定 api key

打开命令行输出的 config 文件位置，添加 api key，或使用其他服务，如 ollama

你也可以在 md 文件里通过源文件和 yaml 设定相关参数

以下是文件解析配置，值都为字符串

| 键       | 解释                                                                                                                                                 |
| -------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| ignore   | 注释，默认`//`                                                                                                                                       |
| user     | 用户输入                                                                                                                                             |
| ai       | ai 回答                                                                                                                                              |
| ask      | 运行标识，默认`?`，空行输入后保存即可进行 ai 推理                                                                                                    |
| answer   | ai 回答的字符模板，用`$&`指代回答，默认为`\n!>\n$&`，注意 ai 应包括在 answer，否则无法正确解析 ai 回答                                               |
| shareSys | 同步 system 提示词，默认`false`，启用后，在同一个文件将使用同一个 system 提示词，不管是否新建对话。若存在多个，则以 ask 标识符向上最近的 system 为准 |

ai 配置，在配置文件中 models 相关定义，在元数据配置里还要放在`config`键后

| 键     | 解释                                                        |
| ------ | ----------------------------------------------------------- |
| type   | 可选"chatgpt"或"gemini"                                     |
| key    | api key                                                     |
| option | 补充到请求的 object，如`model_name`，对话数据程序会自动补上 |

markdown 示例：

```markdown
---
user: "👤："
ai: "🤖："
ask: "!!"
answer: "\n🤖：\n$&"
config.type: "gemini"
---

在文件开头不加任何前缀的视为`system`，gemini 则转为`user`

👤：你好
!!
```

markdown 不是必需的，任意文本文件都可以，但鉴于 ai 一般会返回 markdown 格式，用 md 文件在好不过

在新建对话时，建议`---`上保留个空行，这对本程序无影响，但可能影响 md 编辑器渲染

## 图片与文件

可以使用图片或链接传入文件，注意使用块语法，即换行输入`[]()`

支持相对路径

可解析所有非二进制文档，可解析 docx 和 xlsx

## 杂谈

尽管你可以自由编辑文件，但不建议用岁月史书调侃 ai

暂不支持流输入，欢迎 pull

yaml 我学不会，但为了符合主流 md 元数据标准所以就加上支持了。yaml 是 json 的超集，所以可以在配置里写 json

本来这个项目是因为我想在只有 1g 内存的树莓派上用 vscode 和 ai，但若再开一个浏览器会卡死，终端应用不会写，原生界面也不会写，所以就拿文件进行交互了。本来想用 rust 写的，但一我不会，二树莓派死活装不上网络请求依赖，故用 nodejs
